<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>The OG Barber</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family: Arial; margin:0; background:#df0e0e; }
header { background:#222; color:white; padding:20px; text-align:center; }
.container { max-width:1000px; margin:40px auto; padding:20px; }

.card {
    background:rgb(7, 4, 7);
    padding:20px;
    border-radius:10px;
    box-shadow:0 10px 30px rgba(0,0,0,0.1);
    margin-bottom:20px;
    transition:0.4s;
}

button {
    padding:10px 20px;
    border:none;
    background:black;
    color:white;
    cursor:pointer;
    border-radius:5px;
}

button:hover { opacity:0.8; }

.service {
    display:flex;
    justify-content:space-between;
    margin-bottom:10px;
}

.calendar {
    display:grid;
    grid-template-columns:repeat(7,1fr);
    gap:10px;
}

.day {
    padding:15px;
    background:#eee;
    text-align:center;
    cursor:pointer;
    border-radius:5px;
}

.day:hover { background:#ccc; }

.times {
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:10px;
    margin-top:20px;
}

.time {
    padding:10px;
    background:#eee;
    text-align:center;
    cursor:pointer;
    border-radius:5px;
}

.time:hover { background:#ccc; }

.hidden { display:none; }

.total-box {
    font-size:20px;
    font-weight:bold;
    margin-top:20px;
}

.success {
    background:#d4edda;
    padding:20px;
    border-radius:10px;
}
</style>
</head>

<body>

<header>
<h1>Luxury Barber Booking</h1>
</header>

<div class="container">

<div id="step1" class="card">
<h2>Select Services</h2>

<div id="services"></div>

<div class="total-box">
Total: Â£<span id="total">0</span>
</div>

<button onclick="goToCalendar()">Next</button>
</div>

<div id="step2" class="card hidden">
<h2>Select Date</h2>
<div id="calendar" class="calendar"></div>
<button onclick="goToTimes()">Next</button>
</div>

<div id="step3" class="card hidden">
<h2>Select Time</h2>
<div class="times" id="times"></div>
<button onclick="confirmBooking()">Confirm Booking</button>
</div>

<div id="step4" class="card hidden success">
<h2>Booking Confirmed ðŸŽ‰</h2>
<p id="confirmationText"></p>
</div>

</div>

<script>
const serviceData = [
    { name: "Haircut", price: 20 },
    { name: "Skin Fade", price: 25 },
    { name: "Beard Trim", price: 15 },
    { name: "Hair & Beard", price: 35 }
];

let selectedServices = [];
let total = 0;
let selectedDate = "";
let selectedTime = "";

const servicesDiv = document.getElementById("services");

serviceData.forEach(service => {
    const div = document.createElement("div");
    div.className = "service";
    div.innerHTML = `
        <span>${service.name} (Â£${service.price})</span>
        <input type="checkbox" onchange="toggleService('${service.name}', ${service.price})">
    `;
    servicesDiv.appendChild(div);
});

function toggleService(name, price) {
    if (selectedServices.includes(name)) {
        selectedServices = selectedServices.filter(s => s !== name);
        total -= price;
    } else {
        selectedServices.push(name);
        total += price;
    }
    document.getElementById("total").innerText = total;
}

function goToCalendar() {
    if (selectedServices.length === 0) return alert("Select a service.");
    document.getElementById("step1").classList.add("hidden");
    document.getElementById("step2").classList.remove("hidden");
}

function generateCalendar() {
    const calendar = document.getElementById("calendar");
    calendar.innerHTML = "";
    const today = new Date();

    for (let i = 0; i < 21; i++) {
        const date = new Date();
        date.setDate(today.getDate() + i);
        const div = document.createElement("div");
        div.className = "day";
        div.innerText = date.toDateString();
        div.onclick = () => {
            selectedDate = date.toDateString();
            alert("Selected: " + selectedDate);
        };
        calendar.appendChild(div);
    }
}

generateCalendar();

function goToTimes() {
    if (!selectedDate) return alert("Select a date.");
    document.getElementById("step2").classList.add("hidden");
    document.getElementById("step3").classList.remove("hidden");
}

const timesDiv = document.getElementById("times");
const timeSlots = ["09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00"];

timeSlots.forEach(t => {
    const div = document.createElement("div");
    div.className = "time";
    div.innerText = t;
    div.onclick = () => {
        selectedTime = t;
        alert("Selected time: " + t);
    };
    timesDiv.appendChild(div);
});

async function confirmBooking() {
    if (!selectedTime) return alert("Select time.");

    const response = await fetch("/book", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            date: selectedDate,
            time: selectedTime,
            services: selectedServices,
            total
        })
    });

    const data = await response.json();

    if (!response.ok) {
        alert(data.message);
        return;
    }

    document.getElementById("step3").classList.add("hidden");
    document.getElementById("step4").classList.remove("hidden");
    document.getElementById("confirmationText").innerText =
        `${selectedDate} at ${selectedTime}\nServices: ${selectedServices.join(", ")}\nTotal: Â£${total}`;
}
</script>

</body>
</html>